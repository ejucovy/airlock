<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://ejucovy.github.io/airlock/api/core/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Core - Airlock</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Core";
        var mkdocs_page_input_path = "api/core.md";
        var mkdocs_page_url = "/airlock/api/core/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Airlock
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Understanding Airlock</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../understanding/the-problem/">The Problem</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../understanding/core-model/">Core Model (3 Concerns)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../understanding/design-invariants/">Design Invariants</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../understanding/nesting/">Nesting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../understanding/alternatives/">Alternatives</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Django</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../django/">Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Celery</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../celery/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../celery/migration/">Migration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Extending</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../extending/custom-policies/">Custom Policies</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../extending/custom-executors/">Custom Executors</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../extending/custom-scopes/">Custom Scopes</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API Reference</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../">Overview</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Core</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#functions">Functions</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#airlock.scope">scope</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#airlock.enqueue">enqueue</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#airlock.policy">policy</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#airlock.get_current_scope">get_current_scope</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#classes">Classes</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#airlock.Scope">Scope</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#airlock.Scope.intents">intents</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#airlock.Scope.own_intents">own_intents</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#airlock.Scope.captured_intents">captured_intents</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#airlock.Scope.is_flushed">is_flushed</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#airlock.Scope.is_discarded">is_discarded</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#airlock.Scope.is_active">is_active</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#airlock.Scope.enter">enter</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#airlock.Scope.exit">exit</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#airlock.Scope.flush">flush</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#airlock.Scope.discard">discard</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#airlock.Scope.should_flush">should_flush</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#airlock.Scope.before_descendant_flushes">before_descendant_flushes</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#airlock.Intent">Intent</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#airlock.Intent.task">task</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#airlock.Intent.args">args</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#airlock.Intent.kwargs">kwargs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#airlock.Intent.origin">origin</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#airlock.Intent.dispatch_options">dispatch_options</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#airlock.Intent.name">name</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#airlock.Intent.local_policies">local_policies</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#airlock.Intent.passes_local_policies">passes_local_policies</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#protocols">Protocols</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#airlock.Policy">Policy</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#airlock.Policy.on_enqueue">on_enqueue</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#airlock.Policy.allows">allows</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#airlock.Executor">Executor</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#airlock.Executor.__call__">__call__</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#built-in-policies">Built-in Policies</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#airlock.AllowAll">AllowAll</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#airlock.DropAll">DropAll</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#airlock.AssertNoEffects">AssertNoEffects</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#airlock.BlockTasks">BlockTasks</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#airlock.LogOnFlush">LogOnFlush</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#airlock.CompositePolicy">CompositePolicy</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#exceptions">Exceptions</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#airlock.AirlockError">AirlockError</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#airlock.UsageError">UsageError</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#airlock.NoScopeError">NoScopeError</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#airlock.PolicyEnqueueError">PolicyEnqueueError</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#airlock.ScopeStateError">ScopeStateError</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#airlock.PolicyViolation">PolicyViolation</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../django/">Django</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../celery/">Celery</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../executors/">Executors</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Airlock</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">API Reference</li>
      <li class="breadcrumb-item active">Core</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/ejucovy/airlock/edit/master/docs/api/core.md">Edit on ejucovy/airlock</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="core-api">Core API<a class="headerlink" href="#core-api" title="Permanent link">&para;</a></h1>
<p>The main airlock module. Import with <code>import airlock</code>.</p>
<h2 id="functions">Functions<a class="headerlink" href="#functions" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-function">


<h2 id="airlock.scope" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">scope</span>


<a href="#airlock.scope" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">scope</span><span class="p">(</span><span class="n">policy</span><span class="p">:</span> <span class="n">Policy</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">Scope</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Scope</span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents first">

        <p>Context manager defining a lifecycle boundary for side effects.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>policy</code></b>
                  (<code><a class="autorefs autorefs-internal" title="Policy (airlock.Policy)" href="#airlock.Policy">Policy</a> | None</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Policy controlling what intents are allowed. Defaults to configured
policy or <code>AllowAll</code> if not configured.</p>
              </div>
            </li>
            <li>
              <b><code>_cls</code></b>
                  (<code><span title="type">type</span>[<a class="autorefs autorefs-internal" title="Scope (airlock.Scope)" href="#airlock.Scope">Scope</a>] | None</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p><code>Scope</code> class to use. Defaults to configured <code>scope_cls</code> or <code>Scope</code>
if not configured. Subclass <code>Scope</code> and override <code>should_flush()</code> to
customize flush/discard behavior.</p>
              </div>
            </li>
            <li>
              <b><code>**kwargs</code></b>
              –
              <div class="doc-md-description">
                <p>Additional arguments passed to <code>Scope</code> constructor (e.g., executor).</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name"></th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>executor</code></b>
              –
              <div class="doc-md-description">
                <p>Callable that executes intents. Defaults to configured executor
or synchronous execution if not configured.
See <code>airlock.integrations.executors</code> for available executors.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<details class="behavior" open>
  <summary>Behavior</summary>
  <ul>
<li>On normal exit: calls <code>flush()</code> if <code>should_flush(None)</code> returns <code>True</code></li>
<li>On exception: calls <code>flush()</code> if <code>should_flush(error)</code> returns <code>True</code>,
  else <code>discard()</code></li>
</ul>
</details>        <p>The default <code>Scope.should_flush()</code> returns <code>True</code> on success, <code>False</code> on error.
Subclass <code>Scope</code> to customize this behavior.</p>


<details class="note" open>
  <summary>Note</summary>
  <p>Arguments passed explicitly always override configured defaults.
Use <code>airlock.configure()</code> to set application-wide defaults.</p>
</details>        <p>Example::</p>
<div class="language-text highlight"><pre><span></span><code># Use celery executor
from airlock.integrations.executors.celery import celery_executor
with airlock.scope(executor=celery_executor):
    airlock.enqueue(my_task, ...)

# Use django-q executor
from airlock.integrations.executors.django_q import django_q_executor
with airlock.scope(executor=django_q_executor):
    airlock.enqueue(my_task, ...)
</code></pre></div>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="airlock.enqueue" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">enqueue</span>


<a href="#airlock.enqueue" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">enqueue</span><span class="p">(</span><span class="n">task</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">_origin</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">_dispatch_options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</span></code></pre></div>

    <div class="doc doc-contents first">

        <p>Express intent to perform a side effect.</p>
<p>This is the ONLY function domain code should call.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>task</code></b>
                  (<code><span title="typing.Callable">Callable</span></code>)
              –
              <div class="doc-md-description">
                <p>The callable to execute (Celery task, function, etc.).</p>
              </div>
            </li>
            <li>
              <b><code>*args</code></b>
                  (<code><span title="typing.Any">Any</span></code>, default:
                      <code>()</code>
)
              –
              <div class="doc-md-description">
                <p>Positional arguments for the task.</p>
              </div>
            </li>
            <li>
              <b><code>_origin</code></b>
                  (<code><span title="str">str</span> | None</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Optional origin metadata for debugging/observability.
This is NOT auto-detected - it must be set explicitly if needed.
Integrations (Django middleware, Celery task wrapper) may set this
to provide context like request path, task name, or trace/span IDs.
For structured observability, prefer OpenTelemetry span context.</p>
              </div>
            </li>
            <li>
              <b><code>_dispatch_options</code></b>
                  (<code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Optional dispatch options (countdown, queue, etc.).
Passed through to the task queue backend (e.g., Celery's <code>apply_async</code>).
Ignored for plain callables.</p>
              </div>
            </li>
            <li>
              <b><code>**kwargs</code></b>
                  (<code><span title="typing.Any">Any</span></code>, default:
                      <code>{}</code>
)
              –
              <div class="doc-md-description">
                <p>Keyword arguments for the task.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><a class="autorefs autorefs-internal" title="PolicyEnqueueError (airlock.PolicyEnqueueError)" href="#airlock.PolicyEnqueueError">PolicyEnqueueError</a></code>
              –
              <div class="doc-md-description">
                <p>If called from within a policy callback.</p>
              </div>
            </li>
            <li>
                  <code><a class="autorefs autorefs-internal" title="NoScopeError (airlock.NoScopeError)" href="#airlock.NoScopeError">NoScopeError</a></code>
              –
              <div class="doc-md-description">
                <p>If no scope is active.</p>
              </div>
            </li>
            <li>
                  <code><a class="autorefs autorefs-internal" title="PolicyViolation (airlock.PolicyViolation)" href="#airlock.PolicyViolation">PolicyViolation</a></code>
              –
              <div class="doc-md-description">
                <p>If a policy explicitly rejects the intent via <code>on_enqueue()</code>.
For example, <code>AssertNoEffects</code> policy raises <code>PolicyViolation</code> on any
enqueue. When this happens, the intent is NOT added to the buffer.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="airlock.policy" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">policy</span>


<a href="#airlock.policy" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">policy</span><span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="n">Policy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents first">

        <p>Context manager for local policy contexts.</p>
<p>Intents enqueued within this context capture the policy and apply it
at flush time. This enables local control without nested buffers.</p>
<p>Example::</p>
<div class="language-text highlight"><pre><span></span><code>with airlock.scope():
    airlock.enqueue(task_a)  # will dispatch

    with airlock.policy(DropAll()):
        airlock.enqueue(task_b)  # will NOT dispatch

    airlock.enqueue(task_c)  # will dispatch
</code></pre></div>
<p>Unlike nested scopes, all intents go to the same buffer. The local
policy is metadata that affects dispatch decisions at flush.</p>


<details class="note" open>
  <summary>Note</summary>
  <p>This does NOT create a new buffer or nested scope. All intents
from within this context still go to the enclosing scope's buffer.
The policy is captured on each intent at enqueue time and evaluated
at flush. This is intentional - it preserves a single dispatch boundary
while allowing fine-grained control over which intents survive.</p>
</details>

    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="airlock.get_current_scope" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_current_scope</span>


<a href="#airlock.get_current_scope" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_current_scope</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Scope</span> <span class="o">|</span> <span class="kc">None</span>
</span></code></pre></div>

    <div class="doc doc-contents first">

        <p>Get the currently active airlock scope, if any.</p>


    </div>

</div><h2 id="classes">Classes<a class="headerlink" href="#classes" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h2 id="airlock.Scope" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">Scope</span>


<a href="#airlock.Scope" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">



        <p>A lifecycle scope that buffers and controls side effect intents.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>policy</code></b>
                  (<code><a class="autorefs autorefs-internal" title="Policy (airlock.Policy)" href="#airlock.Policy">Policy</a></code>)
              –
              <div class="doc-md-description">
                <p>Policy controlling what intents are allowed.</p>
              </div>
            </li>
            <li>
              <b><code>executor</code></b>
                  (<code><a class="autorefs autorefs-internal" title="Executor (airlock.Executor)" href="#airlock.Executor">Executor</a> | None</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Callable that executes intents. Defaults to synchronous execution.
See <code>airlock.integrations.executors</code> for available executors.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>









<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="airlock.Scope.intents" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">intents</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#airlock.Scope.intents" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">intents</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Intent</span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Read-only access to buffered intents for inspection.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="airlock.Scope.own_intents" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">own_intents</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#airlock.Scope.own_intents" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">own_intents</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Intent</span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Intents enqueued directly in this scope (not captured from nested scopes).</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="airlock.Scope.captured_intents" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">captured_intents</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#airlock.Scope.captured_intents" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">captured_intents</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Intent</span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Intents captured from nested scopes.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="airlock.Scope.is_flushed" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">is_flushed</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#airlock.Scope.is_flushed" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">is_flushed</span><span class="p">:</span> <span class="nb">bool</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="airlock.Scope.is_discarded" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">is_discarded</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#airlock.Scope.is_discarded" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">is_discarded</span><span class="p">:</span> <span class="nb">bool</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="airlock.Scope.is_active" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">is_active</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#airlock.Scope.is_active" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">is_active</span><span class="p">:</span> <span class="nb">bool</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>True if this scope is currently the active scope.</p>

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="airlock.Scope.enter" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">enter</span>


<a href="#airlock.Scope.enter" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">enter</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Scope</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Activate this scope.</p>
<p>Sets the context var so <code>enqueue()</code> routes intents to this scope.
Must call <code>exit()</code> when done, before calling <code>flush()</code> or <code>discard()</code>.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><a class="autorefs autorefs-internal" title="Scope (airlock.Scope)" href="#airlock.Scope">Scope</a></code>
              –
              <div class="doc-md-description">
                <p>Self for chaining.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><a class="autorefs autorefs-internal" title="ScopeStateError (airlock.ScopeStateError)" href="#airlock.ScopeStateError">ScopeStateError</a></code>
              –
              <div class="doc-md-description">
                <p>If this scope is already active.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="airlock.Scope.exit" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">exit</span>


<a href="#airlock.Scope.exit" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">exit</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Deactivate this scope.</p>
<p>Resets the context var to the previous scope (or <code>None</code>).
Must be called before <code>flush()</code> or <code>discard()</code>.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><a class="autorefs autorefs-internal" title="ScopeStateError (airlock.ScopeStateError)" href="#airlock.ScopeStateError">ScopeStateError</a></code>
              –
              <div class="doc-md-description">
                <p>If this scope is not active.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="airlock.Scope.flush" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">flush</span>


<a href="#airlock.Scope.flush" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">flush</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Intent</span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Flush all buffered intents - apply policy and dispatch.</p>
<p>Filters intents through policies (both local and scope-level), then dispatches
them in FIFO order using the configured executor.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="Intent


  
      dataclass
   (airlock.Intent)" href="#airlock.Intent">Intent</a>]</code>
              –
              <div class="doc-md-description">
                <p>List of intents that were dispatched (after policy filtering).</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><a class="autorefs autorefs-internal" title="ScopeStateError (airlock.ScopeStateError)" href="#airlock.ScopeStateError">ScopeStateError</a></code>
              –
              <div class="doc-md-description">
                <p>If scope is already flushed, discarded, or still active.</p>
              </div>
            </li>
            <li>
                  <code><span title="Exception">Exception</span></code>
              –
              <div class="doc-md-description">
                <p>Any exception raised by the executor during dispatch (fail-fast
behavior). See <code>_dispatch_all()</code> docstring for details on exception
handling.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<details class="note" open>
  <summary>Note</summary>
  <p>The scope is marked as flushed even if an executor raises an exception.
This prevents retry attempts, as the scope is in an inconsistent state
(some intents may have been dispatched before the failure).</p>
</details>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="airlock.Scope.discard" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">discard</span>


<a href="#airlock.Scope.discard" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">discard</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Intent</span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Discard all buffered intents without dispatching.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="airlock.Scope.should_flush" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">should_flush</span>


<a href="#airlock.Scope.should_flush" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">should_flush</span><span class="p">(</span><span class="n">error</span><span class="p">:</span> <span class="ne">BaseException</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Decide terminal action when context manager exits.</p>
<p>Override this method in subclasses to customize flush/discard behavior.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>error</code></b>
                  (<code><span title="BaseException">BaseException</span> | None</code>)
              –
              <div class="doc-md-description">
                <p>The exception that caused exit, or <code>None</code> for normal exit.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="bool">bool</span></code>
              –
              <div class="doc-md-description">
                <p><code>True</code> to flush (dispatch intents), <code>False</code> to discard.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>        <p>Default behavior: flush on success, discard on error.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="airlock.Scope.before_descendant_flushes" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">before_descendant_flushes</span>


<a href="#airlock.Scope.before_descendant_flushes" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">before_descendant_flushes</span><span class="p">(</span><span class="n">exiting_scope</span><span class="p">:</span> <span class="n">Scope</span><span class="p">,</span> <span class="n">intents</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Intent</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Intent</span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Called when a nested scope exits and attempts to flush.</p>
<p>This method is called during the parent chain walk, allowing each ancestor
to decide which intents the exiting scope may flush vs which to capture.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>exiting_scope</code></b>
                  (<code><a class="autorefs autorefs-internal" title="Scope (airlock.Scope)" href="#airlock.Scope">Scope</a></code>)
              –
              <div class="doc-md-description">
                <p>The nested scope that is exiting (may be deeply nested).</p>
              </div>
            </li>
            <li>
              <b><code>intents</code></b>
                  (<code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="Intent


  
      dataclass
   (airlock.Intent)" href="#airlock.Intent">Intent</a>]</code>)
              –
              <div class="doc-md-description">
                <p>The list of intents the exiting scope wants to flush.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="Intent


  
      dataclass
   (airlock.Intent)" href="#airlock.Intent">Intent</a>]</code>
              –
              <div class="doc-md-description">
                <p>The list of intents to allow through (the exiting scope will flush these).</p>
              </div>
            </li>
            <li>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="Intent


  
      dataclass
   (airlock.Intent)" href="#airlock.Intent">Intent</a>]</code>
              –
              <div class="doc-md-description">
                <p>Any intents not in the returned list are captured into this scope's buffer.</p>
              </div>
            </li>
            <li>
<b><code>IMPORTANT</code></b>(                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="Intent


  
      dataclass
   (airlock.Intent)" href="#airlock.Intent">Intent</a>]</code>
)              –
              <div class="doc-md-description">
                <p>Must return a list. Returning <code>None</code> or other types raises</p>
              </div>
            </li>
            <li>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="Intent


  
      dataclass
   (airlock.Intent)" href="#airlock.Intent">Intent</a>]</code>
              –
              <div class="doc-md-description">
                <p><code>TypeError</code>.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="TypeError">TypeError</span></code>
              –
              <div class="doc-md-description">
                <p>If return value is not a list.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>        <p>Default behavior: Capture all intents (return <code>[]</code>).
This is the controlled default - outer scopes have authority over nested scopes.</p>
<p>Override this method to allow nested scopes to flush independently:</p>
<ul>
<li>Return <code>[]</code> to capture all intents (default, controlled)</li>
<li>Return <code>intents</code> to allow all (independent nested scopes)</li>
<li>Return filtered list to selectively capture</li>
</ul>


<details class="note" open>
  <summary>Note</summary>
  <ul>
<li>Do not mutate the <code>intents</code> list. Return a new list or slice.</li>
<li>Returning intents not in the input list has undefined behavior.</li>
<li>In multi-level nesting, <code>exiting_scope</code> is always the innermost scope,
  not necessarily the immediate child. Intermediate scopes haven't exited yet.</li>
</ul>
</details>        <p>Example::</p>
<div class="language-text highlight"><pre><span></span><code>class IndependentScope(Scope):
    def before_descendant_flushes(self, exiting_scope, intents):
        return intents  # Allow nested scopes to flush independently

class SmartScope(Scope):
    def before_descendant_flushes(self, exiting_scope, intents):
        # Capture dangerous tasks, allow safe ones
        return [i for i in intents if &#39;dangerous&#39; not in i.name]
</code></pre></div>


    </div>

</div>



  </div>

    </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="airlock.Intent" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">Intent</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#airlock.Intent" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">



        <p>Represents the intent to perform a side effect.</p>
<p>Stores the actual callable, not just a name. The <code>name</code> property
derives a string for serialization/logging.</p>
<p>Captures local policy context at enqueue time for introspection
and deferred application at flush.</p>










<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="airlock.Intent.task" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">task</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#airlock.Intent.task" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">task</span><span class="p">:</span> <span class="n">Callable</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="airlock.Intent.args" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">args</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#airlock.Intent.args" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">args</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="airlock.Intent.kwargs" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">kwargs</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#airlock.Intent.kwargs" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="airlock.Intent.origin" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">origin</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#airlock.Intent.origin" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">origin</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="airlock.Intent.dispatch_options" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">dispatch_options</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#airlock.Intent.dispatch_options" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">dispatch_options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="airlock.Intent.name" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">name</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#airlock.Intent.name" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Derived name for serialization/logging.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="airlock.Intent.local_policies" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">local_policies</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#airlock.Intent.local_policies" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">local_policies</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Policy</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Local policies captured at enqueue time.</p>

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="airlock.Intent.passes_local_policies" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">passes_local_policies</span>


<a href="#airlock.Intent.passes_local_policies" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">passes_local_policies</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if this intent passes its captured local policies.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="bool">bool</span></code>
              –
              <div class="doc-md-description">
                <p>True if all local policies allow this intent.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<details class="note" open>
  <summary>Note</summary>
  <p>This does NOT guarantee the intent will be dispatched. It does not
consider:</p>
<ul>
<li>Scope-level policy (checked separately at flush)</li>
<li>Whether the scope flushes or discards</li>
<li>Dispatch execution success</li>
</ul>
<p>Use for inspection and audit, not execution prediction.</p>
</details>

    </div>

</div>



  </div>

    </div>


</div><h2 id="protocols">Protocols<a class="headerlink" href="#protocols" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h2 id="airlock.Policy" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">Policy</span>


<a href="#airlock.Policy" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Protocol">Protocol</span></code></p>



        <p>Protocol for side effect policies.</p>
<p>Policies are per-intent boolean gates that decide which intents dispatch.
This design enforces FIFO order by construction - policies can filter
intents but cannot reorder them.</p>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="on_enqueue (airlock.Policy.on_enqueue)" href="#airlock.Policy.on_enqueue">on_enqueue</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Called when an intent is added to the buffer. Use for
observation, logging, or raising <code>PolicyViolation</code> for hard blocks.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="allows (airlock.Policy.allows)" href="#airlock.Policy.allows">allows</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Called at flush time for each intent. Return <code>True</code> to dispatch,
<code>False</code> to silently drop.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="airlock.Policy.on_enqueue" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">on_enqueue</span>


<a href="#airlock.Policy.on_enqueue" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">on_enqueue</span><span class="p">(</span><span class="n">intent</span><span class="p">:</span> <span class="n">Intent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Called when an intent is added to the buffer. Observe or raise <code>PolicyViolation</code>.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="airlock.Policy.allows" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">allows</span>


<a href="#airlock.Policy.allows" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">allows</span><span class="p">(</span><span class="n">intent</span><span class="p">:</span> <span class="n">Intent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Called at flush time. Return <code>True</code> to dispatch, <code>False</code> to drop.</p>


    </div>

</div>



  </div>

    </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="airlock.Executor" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">Executor</span>


<a href="#airlock.Executor" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Protocol">Protocol</span></code></p>



        <p>Protocol for intent executors.</p>
<p>An executor is a callable that takes an <code>Intent</code> and executes it
via some dispatch mechanism (synchronous, Celery, django-q, etc.).</p>
<p>Built-in executors are available in <code>airlock.integrations.executors</code>:</p>
<ul>
<li><code>sync_executor</code>: Synchronous execution (default)</li>
<li><code>celery_executor</code>: Dispatch via Celery <code>.delay()</code> / <code>.apply_async()</code></li>
<li><code>django_q_executor</code>: Dispatch via django-q's <code>async_task()</code></li>
<li><code>django_tasks_executor</code>: Dispatch via Django 6+'s built-in tasks framework</li>
<li><code>huey_executor</code>: Dispatch via Huey's <code>.schedule()</code></li>
<li><code>dramatiq_executor</code>: Dispatch via Dramatiq's <code>.send()</code></li>
</ul>
<p>Custom executors can be written by implementing this protocol.</p>










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="airlock.Executor.__call__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__call__</span>


<a href="#airlock.Executor.__call__" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">__call__</span><span class="p">(</span><span class="n">intent</span><span class="p">:</span> <span class="n">Intent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Execute the given intent.</p>


    </div>

</div>



  </div>

    </div>


</div><h2 id="built-in-policies">Built-in Policies<a class="headerlink" href="#built-in-policies" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h2 id="airlock.AllowAll" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">AllowAll</span>


<a href="#airlock.AllowAll" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">



        <p>Policy that allows all side effects.</p>










<div class="doc doc-children">












  </div>

    </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="airlock.DropAll" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">DropAll</span>


<a href="#airlock.DropAll" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">



        <p>Policy that drops all side effects.</p>










<div class="doc doc-children">












  </div>

    </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="airlock.AssertNoEffects" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">AssertNoEffects</span>


<a href="#airlock.AssertNoEffects" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">



        <p>Policy that raises if any side effect is attempted.</p>










<div class="doc doc-children">












  </div>

    </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="airlock.BlockTasks" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">BlockTasks</span>


<a href="#airlock.BlockTasks" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">



        <p>Policy that blocks specific tasks by name.</p>










<div class="doc doc-children">












  </div>

    </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="airlock.LogOnFlush" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">LogOnFlush</span>


<a href="#airlock.LogOnFlush" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">



        <p>Policy that logs intents at flush time (allows all).</p>










<div class="doc doc-children">












  </div>

    </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="airlock.CompositePolicy" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">CompositePolicy</span>


<a href="#airlock.CompositePolicy" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">



        <p>Policy that combines multiple policies (all must allow).</p>










<div class="doc doc-children">












  </div>

    </div>


</div><h2 id="exceptions">Exceptions<a class="headerlink" href="#exceptions" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h2 id="airlock.AirlockError" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">AirlockError</span>


<a href="#airlock.AirlockError" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="Exception">Exception</span></code></p>



        <p>Base exception for all airlock errors.</p>








    </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="airlock.UsageError" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">UsageError</span>


<a href="#airlock.UsageError" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="AirlockError (airlock.AirlockError)" href="#airlock.AirlockError">AirlockError</a></code></p>



        <p>Raised when airlock is used incorrectly (API misuse).</p>








    </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="airlock.NoScopeError" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">NoScopeError</span>


<a href="#airlock.NoScopeError" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="UsageError (airlock.UsageError)" href="#airlock.UsageError">UsageError</a></code></p>



        <p>Raised when <code>enqueue()</code> is called with no active scope.</p>
<p>This is intentional: airlock requires explicit lifecycle boundaries.
Side effects should not escape silently. Every <code>enqueue()</code> must occur
within a <code>scope()</code> that decides when (and whether) effects dispatch.</p>
<p>If you're seeing this error, wrap your code in an <code>airlock.scope()</code>::</p>
<div class="language-text highlight"><pre><span></span><code>with airlock.scope():
    do_stuff()  # enqueue() calls are now valid
</code></pre></div>








    </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="airlock.PolicyEnqueueError" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">PolicyEnqueueError</span>


<a href="#airlock.PolicyEnqueueError" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="UsageError (airlock.UsageError)" href="#airlock.UsageError">UsageError</a></code></p>



        <p>Raised when <code>enqueue()</code> is called from within a policy callback.</p>








    </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="airlock.ScopeStateError" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ScopeStateError</span>


<a href="#airlock.ScopeStateError" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="AirlockError (airlock.AirlockError)" href="#airlock.AirlockError">AirlockError</a></code></p>



        <p>Raised when an operation is invalid for the scope's current lifecycle state.</p>








    </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="airlock.PolicyViolation" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">PolicyViolation</span>


<a href="#airlock.PolicyViolation" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="AirlockError (airlock.AirlockError)" href="#airlock.AirlockError">AirlockError</a></code></p>



        <p>Raised when a policy explicitly rejects an intent.</p>








    </div>


</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../" class="btn btn-neutral float-left" title="Overview"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../django/" class="btn btn-neutral float-right" title="Django">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/ejucovy/airlock" class="fa fa-code-fork" style="color: #fcfcfc"> ejucovy/airlock</a>
        </span>
    
    
      <span><a href="../" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../django/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
